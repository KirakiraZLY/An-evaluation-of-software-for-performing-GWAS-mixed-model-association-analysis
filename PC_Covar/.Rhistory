theme_light() +
coord_equal() +
theme_light() +
xlab(paste0("PC1 (", signif(pve$pve[1],3), "%)")) +
ylab(paste0("PC2 (",signif(pve$pve[2],3),"%)")) +
labs(title = "PCA on population structure, real")
# plinkPCA$region <- region$X1
# # colnames(plinkPCA)[21] <- "pop"
# plinkPCA$col<- ifelse(plinkPCA$pop >= 0, 1, 0)
# plinkPCA$col<-as.factor(plinkPCA$col)
# plinkPCA1 <- subset(plinkPCA1, ethnic != 'NA')
# plinkPCA_kmeans_sub$ethnic.x[plinkPCA_kmeans_sub$ethnic.x == "Black or Black British"] <- 'White'
# plinkPCA_kmeans_sub$ethnic.x[plinkPCA_kmeans_sub$ethnic.x == "Mixed"] <- 'Mixed'
# plinkPCA_kmeans_sub$ethnic.x[plinkPCA_kmeans_sub$ethnic.x == "White"] <- 'Asian or Asian British(Chinese included)'
# plinkPCA_kmeans_sub$ethnic.x[plinkPCA_kmeans_sub$ethnic.x == "Asian or Asian British(Chinese included)"] <- 'Black or Black British'
ggplot(plinkPCA_kmeans_sub, aes(PC1.x,PC2.x, color = ethnic.x)) +
geom_point(size = 3) +
coord_equal() +
theme_light() +
coord_equal() +
theme_light() +
xlab(paste0("PC1 (", signif(pve$pve[1],3), "%)")) +
ylab(paste0("PC2 (",signif(pve$pve[2],3),"%)")) +
labs(title = "PCA on population structure, K-means")
count = 0
for (i in 1:60042) {
if (plinkPCA_kmeans_sub[i,22] == region_1[i,22]) {  ## plinkPCA2[i]$ethnic == region_1[i]$ethnic
count = count + 1
}
}
acc = count / 60042
acc
fam <- read_table2("data_qc.fam",
col_names = FALSE)
fam$region <- km$cluster
# library(GENESIS)
library(qqman)
library(tidyverse)
library(tidyr)
plinkPCA <- read_table2("data_prune_pca.eigenvec",
col_names = FALSE)
plinkPCA <- plinkPCA[,c(-1,-2)] # Remove first 2 columns
EigenValue <- scan("data_prune_pca.eigenval")
# view(EigenValue)
names(plinkPCA)[1:ncol(plinkPCA)] <- paste0("PC", 1:(ncol(plinkPCA)))
pve <- data.frame(PC = 1:20, pve = EigenValue / sum(EigenValue) * 100)
ggplot(pve, aes(PC,pve)) +
geom_bar(stat = "identity") +
ylab("Percentage variance explained") +
theme_light()
ggplot(plinkPCA, aes(PC1,PC2)) +
geom_point(size = 3) +
coord_equal() +
theme_light() +
coord_equal() +
theme_light() +
xlab(paste0("PC1 (", signif(pve$pve[1],3), "%)")) +
ylab(paste0("PC2 (",signif(pve$pve[2],3),"%)"))
# (pop <- rep(c("A","B"), each = nrow(plinkPCA) / 2))  ## Naively regroup
# pop <- as.data.frame(pop)
# pop <- rbind(pop,"B") # Odd number, so add one value manually
# mypop = read_tsv("pop.txt", col_names = FALSE) # Read from file
iid = read_table2("data_qc.fam",
col_names = FALSE)
region = read_table2("ethnic.txt",col_names = TRUE)
plinkPCA$iid <- iid$X2
colnames(plinkPCA)[21] <- 'iid'
colnames(region)[1] <- 'iid'
plinkPCA1 <- merge(x = plinkPCA, y = region, by = "iid", all.x = TRUE)
plinkPCA1 <- plinkPCA1[,-c(23,24)]
colnames(plinkPCA1)[22] <- 'ethnic'
# table(plinkPCA1$ethnic)
plinkPCA1$ethnic[plinkPCA1$ethnic == "1"] <- 'White'
plinkPCA1$ethnic[plinkPCA1$ethnic == "1001"] <- 'White'
plinkPCA1$ethnic[plinkPCA1$ethnic == "1002"] <- 'White'
plinkPCA1$ethnic[plinkPCA1$ethnic == "1003"] <- 'White'
plinkPCA1$ethnic[plinkPCA1$ethnic == "2"] <- 'Mixed'
plinkPCA1$ethnic[plinkPCA1$ethnic == "2001"] <- 'Mixed'
plinkPCA1$ethnic[plinkPCA1$ethnic == "2002"] <- 'Mixed'
plinkPCA1$ethnic[plinkPCA1$ethnic == "2003"] <- 'Mixed'
plinkPCA1$ethnic[plinkPCA1$ethnic == "2004"] <- 'Mixed'
plinkPCA1$ethnic[plinkPCA1$ethnic == "3"] <- 'Asian or Asian British'
plinkPCA1$ethnic[plinkPCA1$ethnic == "3001"] <- 'Asian or Asian British'
plinkPCA1$ethnic[plinkPCA1$ethnic == "3002"] <- 'Asian or Asian British'
plinkPCA1$ethnic[plinkPCA1$ethnic == "3003"] <- 'Asian or Asian British'
plinkPCA1$ethnic[plinkPCA1$ethnic == "3004"] <- 'Asian or Asian British'
plinkPCA1$ethnic[plinkPCA1$ethnic == "5"] <- 'Chinese'
plinkPCA1$ethnic[plinkPCA1$ethnic == "4"] <- 'Black or Black British'
plinkPCA1$ethnic[plinkPCA1$ethnic == "4001"] <- 'Black or Black British'
plinkPCA1$ethnic[plinkPCA1$ethnic == "4002"] <- 'Black or Black British'
plinkPCA1$ethnic[plinkPCA1$ethnic == "4003"] <- 'Black or Black British'
# plinkPCA1$ethnic[plinkPCA1$ethnic == "5"] <- 'Zhong Guo'
plinkPCA1$ethnic[plinkPCA1$ethnic == "-1"] <- 'NA'
plinkPCA1$ethnic[plinkPCA1$ethnic == "-3"] <- 'NA'
plinkPCA1$ethnic[plinkPCA1$ethnic == "6"] <- 'NA'
# iid_1 <- iid$X1
region_1 <- merge(plinkPCA1,region,all.x = TRUE,by="iid")
region_1$ethnic[region_1$ethnic == "1"] <- 'White'
region_1$ethnic[region_1$ethnic == "1001"] <- 'White'
region_1$ethnic[region_1$ethnic == "1002"] <- 'White'
region_1$ethnic[region_1$ethnic == "1003"] <- 'White'
region_1$ethnic[region_1$ethnic == "2"] <- 'Mixed'
region_1$ethnic[region_1$ethnic == "2001"] <- 'Mixed'
region_1$ethnic[region_1$ethnic == "2002"] <- 'Mixed'
region_1$ethnic[region_1$ethnic == "2003"] <- 'Mixed'
region_1$ethnic[region_1$ethnic == "2004"] <- 'Mixed'
region_1$ethnic[region_1$ethnic == "3"] <- 'Asian or Asian British'
region_1$ethnic[region_1$ethnic == "3001"] <- 'Asian or Asian British'
region_1$ethnic[region_1$ethnic == "3002"] <- 'Asian or Asian British'
region_1$ethnic[region_1$ethnic == "3003"] <- 'Asian or Asian British'
region_1$ethnic[region_1$ethnic == "3004"] <- 'Asian or Asian British'
region_1$ethnic[region_1$ethnic == "5"] <- 'Chinese'
region_1$ethnic[region_1$ethnic == "4"] <- 'Black or Black British'
region_1$ethnic[region_1$ethnic == "4001"] <- 'Black or Black British'
region_1$ethnic[region_1$ethnic == "4002"] <- 'Black or Black British'
region_1$ethnic[region_1$ethnic == "4003"] <- 'Black or Black British'
# plinkPCA1$ethnic[plinkPCA1$ethnic == "5"] <- 'Zhong Guo'
region_1$ethnic[region_1$ethnic == "-1"] <- 'NA'
region_1$ethnic[region_1$ethnic == "-3"] <- 'NA'
region_1$ethnic[region_1$ethnic == "6"] <- 'NA'
region_1 <- subset(region_1, ethnic != 'NA')
plinkPCA2 <- merge(plinkPCA1,region_1,all.y = TRUE,by="iid")
# colnames(plinkPCA2)[ethnic.y] <- "ethnic"
# colnames(plinkPCA2)[43] <- 'ethnic'
# intersect(region_1$ethnic, plinkPCA2$ethnic)
# ggplot(plinkPCA2, aes(PC1.x,PC2.x, color = ethnic.x)) +
#   geom_point(size = 3) +
#   coord_equal() +
#   theme_light() +
#   coord_equal() +
#   theme_light() +
#   xlab(paste0("PC1 (", signif(pve$pve[1],3), "%)")) +
#   ylab(paste0("PC2 (",signif(pve$pve[2],3),"%)")) +
#   labs(title = "PCA on population structure")
#
# ggplot(region_1, aes(PC1,PC2, color = ethnic)) +
#   geom_point(size = 3) +
#   coord_equal() +
#   theme_light() +
#   coord_equal() +
#   theme_light() +
#   xlab(paste0("PC1 (", signif(pve$pve[1],3), "%)")) +
#   ylab(paste0("PC2 (",signif(pve$pve[2],3),"%)")) +
#   labs(title = "PCA on population structure")
plinkPCA_kmeans <- read_table2("data_prune_pca.eigenvec",
col_names = FALSE)
plinkPCA_kmeans <- plinkPCA_kmeans[,-c(1,2)] # Remove first 2 columns
EigenValue <- scan("data_prune_pca.eigenval")
names(plinkPCA_kmeans)[1:ncol(plinkPCA_kmeans)] <- paste0("PC", 1:(ncol(plinkPCA_kmeans)))
pve <- data.frame(PC = 1:20, pve = EigenValue / sum(EigenValue) * 100)
library(randomForest)
library(cluster)
set.seed(0)
plinkPCAsub <- plinkPCA_kmeans[,c('PC1','PC2')]
km = kmeans(plinkPCAsub, centers = 5)
# km$cluster
plinkPCA_kmeans$ethnic <- km$cluster
plinkPCA_kmeans$iid <- iid$X2
plinkPCA_kmeans_sub <- merge(plinkPCA_kmeans,region_1,all.y = TRUE,by="iid")
# colnames(plinkPCA_kmeans_sub, prefix = ethnic.x) <- "ethnic"
ggplot(region_1, aes(PC1,PC2, color = ethnic)) +
geom_point(size = 3) +
coord_equal() +
theme_light() +
coord_equal() +
theme_light() +
xlab(paste0("PC1 (", signif(pve$pve[1],3), "%)")) +
ylab(paste0("PC2 (",signif(pve$pve[2],3),"%)")) +
labs(title = "PCA on population structure, real")
# plinkPCA$region <- region$X1
# # colnames(plinkPCA)[21] <- "pop"
# plinkPCA$col<- ifelse(plinkPCA$pop >= 0, 1, 0)
# plinkPCA$col<-as.factor(plinkPCA$col)
# plinkPCA1 <- subset(plinkPCA1, ethnic != 'NA')
# plinkPCA_kmeans_sub$ethnic.x[plinkPCA_kmeans_sub$ethnic.x == "Black or Black British"] <- 'White'
# plinkPCA_kmeans_sub$ethnic.x[plinkPCA_kmeans_sub$ethnic.x == "Mixed"] <- 'Mixed'
# plinkPCA_kmeans_sub$ethnic.x[plinkPCA_kmeans_sub$ethnic.x == "White"] <- 'Asian or Asian British(Chinese included)'
# plinkPCA_kmeans_sub$ethnic.x[plinkPCA_kmeans_sub$ethnic.x == "Asian or Asian British(Chinese included)"] <- 'Black or Black British'
ggplot(plinkPCA_kmeans_sub, aes(PC1.x,PC2.x, color = ethnic.x)) +
geom_point(size = 3) +
coord_equal() +
theme_light() +
coord_equal() +
theme_light() +
xlab(paste0("PC1 (", signif(pve$pve[1],3), "%)")) +
ylab(paste0("PC2 (",signif(pve$pve[2],3),"%)")) +
labs(title = "PCA on population structure, K-means")
plinkPCA_kmeans_sub$ethnic.x[plinkPCA_kmeans_sub$ethnic.x == "3"] <- 'White'
plinkPCA_kmeans_sub$ethnic.x[plinkPCA_kmeans_sub$ethnic.x == "4"] <- 'Mixed'
plinkPCA_kmeans_sub$ethnic.x[plinkPCA_kmeans_sub$ethnic.x == "1"] <- 'Asian or Asian British'
plinkPCA_kmeans_sub$ethnic.x[plinkPCA_kmeans_sub$ethnic.x == "2"] <- 'Black or Black British'
plinkPCA_kmeans_sub$ethnic.x[plinkPCA_kmeans_sub$ethnic.x == "5"] <- 'Chinese'
# plinkPCA_kmeans_sub$ethnic.x[plinkPCA_kmeans_sub$ethnic.x == "White"] <- 'Black or Black British'
# plinkPCA_kmeans_sub$ethnic.x[plinkPCA_kmeans_sub$ethnic.x == "Mixed"] <- 'Asian or Asian British(Chinese included)'
#
# plinkPCA_kmeans_sub$ethnic.x[plinkPCA_kmeans_sub$ethnic.x == "Black or Black British"] <- 'White'
# plinkPCA_kmeans_sub$ethnic.x[plinkPCA_kmeans_sub$ethnic.x == "Asian or Asian British(Chinese included)"] <- 'Mixed'
ggplot(region_1, aes(PC1,PC2, color = ethnic)) +
geom_point(size = 3) +
coord_equal() +
theme_light() +
coord_equal() +
theme_light() +
xlab(paste0("PC1 (", signif(pve$pve[1],3), "%)")) +
ylab(paste0("PC2 (",signif(pve$pve[2],3),"%)")) +
labs(title = "PCA on population structure, real")
# plinkPCA$region <- region$X1
# # colnames(plinkPCA)[21] <- "pop"
# plinkPCA$col<- ifelse(plinkPCA$pop >= 0, 1, 0)
# plinkPCA$col<-as.factor(plinkPCA$col)
# plinkPCA1 <- subset(plinkPCA1, ethnic != 'NA')
# plinkPCA_kmeans_sub$ethnic.x[plinkPCA_kmeans_sub$ethnic.x == "Black or Black British"] <- 'White'
# plinkPCA_kmeans_sub$ethnic.x[plinkPCA_kmeans_sub$ethnic.x == "Mixed"] <- 'Mixed'
# plinkPCA_kmeans_sub$ethnic.x[plinkPCA_kmeans_sub$ethnic.x == "White"] <- 'Asian or Asian British(Chinese included)'
# plinkPCA_kmeans_sub$ethnic.x[plinkPCA_kmeans_sub$ethnic.x == "Asian or Asian British(Chinese included)"] <- 'Black or Black British'
ggplot(plinkPCA_kmeans_sub, aes(PC1.x,PC2.x, color = ethnic.x)) +
geom_point(size = 3) +
coord_equal() +
theme_light() +
coord_equal() +
theme_light() +
xlab(paste0("PC1 (", signif(pve$pve[1],3), "%)")) +
ylab(paste0("PC2 (",signif(pve$pve[2],3),"%)")) +
labs(title = "PCA on population structure, K-means")
count = 0
for (i in 1:60042) {
if (plinkPCA_kmeans_sub[i,22] == region_1[i,22]) {  ## plinkPCA2[i]$ethnic == region_1[i]$ethnic
count = count + 1
}
}
acc = count / 60042
acc
# table(plinkPCA1$ethnic)
plinkPCA1$ethnic[plinkPCA1$ethnic == "1"] <- 'White'
plinkPCA1$ethnic[plinkPCA1$ethnic == "1001"] <- 'White'
plinkPCA1$ethnic[plinkPCA1$ethnic == "1002"] <- 'White'
plinkPCA1$ethnic[plinkPCA1$ethnic == "1003"] <- 'White'
plinkPCA1$ethnic[plinkPCA1$ethnic == "2"] <- 'Mixed'
plinkPCA1$ethnic[plinkPCA1$ethnic == "2001"] <- 'Mixed'
plinkPCA1$ethnic[plinkPCA1$ethnic == "2002"] <- 'Mixed'
plinkPCA1$ethnic[plinkPCA1$ethnic == "2003"] <- 'Mixed'
plinkPCA1$ethnic[plinkPCA1$ethnic == "2004"] <- 'Mixed'
plinkPCA1$ethnic[plinkPCA1$ethnic == "3"] <- 'Asian or Asian British(South, West, Central)'
plinkPCA1$ethnic[plinkPCA1$ethnic == "3001"] <- 'Asian or Asian British(South, West, Central)'
plinkPCA1$ethnic[plinkPCA1$ethnic == "3002"] <- 'Asian or Asian British(South, West, Central)'
plinkPCA1$ethnic[plinkPCA1$ethnic == "3003"] <- 'Asian or Asian British(South, West, Central)'
plinkPCA1$ethnic[plinkPCA1$ethnic == "3004"] <- 'Asian or Asian British(South, West, Central)'
plinkPCA1$ethnic[plinkPCA1$ethnic == "5"] <- 'Chinese'
plinkPCA1$ethnic[plinkPCA1$ethnic == "4"] <- 'Black or Black British'
plinkPCA1$ethnic[plinkPCA1$ethnic == "4001"] <- 'Black or Black British'
plinkPCA1$ethnic[plinkPCA1$ethnic == "4002"] <- 'Black or Black British'
plinkPCA1$ethnic[plinkPCA1$ethnic == "4003"] <- 'Black or Black British'
# plinkPCA1$ethnic[plinkPCA1$ethnic == "5"] <- 'Zhong Guo'
plinkPCA1$ethnic[plinkPCA1$ethnic == "-1"] <- 'NA'
plinkPCA1$ethnic[plinkPCA1$ethnic == "-3"] <- 'NA'
plinkPCA1$ethnic[plinkPCA1$ethnic == "6"] <- 'NA'
# library(GENESIS)
library(qqman)
library(tidyverse)
library(tidyr)
plinkPCA <- read_table2("data_prune_pca.eigenvec",
col_names = FALSE)
plinkPCA <- plinkPCA[,c(-1,-2)] # Remove first 2 columns
EigenValue <- scan("data_prune_pca.eigenval")
# view(EigenValue)
names(plinkPCA)[1:ncol(plinkPCA)] <- paste0("PC", 1:(ncol(plinkPCA)))
pve <- data.frame(PC = 1:20, pve = EigenValue / sum(EigenValue) * 100)
ggplot(pve, aes(PC,pve)) +
geom_bar(stat = "identity") +
ylab("Percentage variance explained") +
theme_light()
ggplot(plinkPCA, aes(PC1,PC2)) +
geom_point(size = 3) +
coord_equal() +
theme_light() +
coord_equal() +
theme_light() +
xlab(paste0("PC1 (", signif(pve$pve[1],3), "%)")) +
ylab(paste0("PC2 (",signif(pve$pve[2],3),"%)"))
# (pop <- rep(c("A","B"), each = nrow(plinkPCA) / 2))  ## Naively regroup
# pop <- as.data.frame(pop)
# pop <- rbind(pop,"B") # Odd number, so add one value manually
# mypop = read_tsv("pop.txt", col_names = FALSE) # Read from file
iid = read_table2("data_qc.fam",
col_names = FALSE)
region = read_table2("ethnic.txt",col_names = TRUE)
plinkPCA$iid <- iid$X2
colnames(plinkPCA)[21] <- 'iid'
colnames(region)[1] <- 'iid'
plinkPCA1 <- merge(x = plinkPCA, y = region, by = "iid", all.x = TRUE)
plinkPCA1 <- plinkPCA1[,-c(23,24)]
colnames(plinkPCA1)[22] <- 'ethnic'
# table(plinkPCA1$ethnic)
plinkPCA1$ethnic[plinkPCA1$ethnic == "1"] <- 'White'
plinkPCA1$ethnic[plinkPCA1$ethnic == "1001"] <- 'White'
plinkPCA1$ethnic[plinkPCA1$ethnic == "1002"] <- 'White'
plinkPCA1$ethnic[plinkPCA1$ethnic == "1003"] <- 'White'
plinkPCA1$ethnic[plinkPCA1$ethnic == "2"] <- 'Mixed'
plinkPCA1$ethnic[plinkPCA1$ethnic == "2001"] <- 'Mixed'
plinkPCA1$ethnic[plinkPCA1$ethnic == "2002"] <- 'Mixed'
plinkPCA1$ethnic[plinkPCA1$ethnic == "2003"] <- 'Mixed'
plinkPCA1$ethnic[plinkPCA1$ethnic == "2004"] <- 'Mixed'
plinkPCA1$ethnic[plinkPCA1$ethnic == "3"] <- 'Asian or Asian British(South, West, Central)'
plinkPCA1$ethnic[plinkPCA1$ethnic == "3001"] <- 'Asian or Asian British(South, West, Central)'
plinkPCA1$ethnic[plinkPCA1$ethnic == "3002"] <- 'Asian or Asian British(South, West, Central)'
plinkPCA1$ethnic[plinkPCA1$ethnic == "3003"] <- 'Asian or Asian British(South, West, Central)'
plinkPCA1$ethnic[plinkPCA1$ethnic == "3004"] <- 'Asian or Asian British(South, West, Central)'
plinkPCA1$ethnic[plinkPCA1$ethnic == "5"] <- 'Chinese'
plinkPCA1$ethnic[plinkPCA1$ethnic == "4"] <- 'Black or Black British'
plinkPCA1$ethnic[plinkPCA1$ethnic == "4001"] <- 'Black or Black British'
plinkPCA1$ethnic[plinkPCA1$ethnic == "4002"] <- 'Black or Black British'
plinkPCA1$ethnic[plinkPCA1$ethnic == "4003"] <- 'Black or Black British'
# plinkPCA1$ethnic[plinkPCA1$ethnic == "5"] <- 'Zhong Guo'
plinkPCA1$ethnic[plinkPCA1$ethnic == "-1"] <- 'NA'
plinkPCA1$ethnic[plinkPCA1$ethnic == "-3"] <- 'NA'
plinkPCA1$ethnic[plinkPCA1$ethnic == "6"] <- 'NA'
# iid_1 <- iid$X1
region_1 <- merge(plinkPCA1,region,all.x = TRUE,by="iid")
region_1$ethnic[region_1$ethnic == "1"] <- 'White'
region_1$ethnic[region_1$ethnic == "1001"] <- 'White'
region_1$ethnic[region_1$ethnic == "1002"] <- 'White'
region_1$ethnic[region_1$ethnic == "1003"] <- 'White'
region_1$ethnic[region_1$ethnic == "2"] <- 'Mixed'
region_1$ethnic[region_1$ethnic == "2001"] <- 'Mixed'
region_1$ethnic[region_1$ethnic == "2002"] <- 'Mixed'
region_1$ethnic[region_1$ethnic == "2003"] <- 'Mixed'
region_1$ethnic[region_1$ethnic == "2004"] <- 'Mixed'
region_1$ethnic[region_1$ethnic == "3"] <- 'Asian or Asian British(South, West, Central)'
region_1$ethnic[region_1$ethnic == "3001"] <- 'Asian or Asian British(South, West, Central)'
region_1$ethnic[region_1$ethnic == "3002"] <- 'Asian or Asian British(South, West, Central)'
region_1$ethnic[region_1$ethnic == "3003"] <- 'Asian or Asian British(South, West, Central)'
region_1$ethnic[region_1$ethnic == "3004"] <- 'Asian or Asian British(South, West, Central)'
region_1$ethnic[region_1$ethnic == "5"] <- 'Chinese'
region_1$ethnic[region_1$ethnic == "4"] <- 'Black or Black British'
region_1$ethnic[region_1$ethnic == "4001"] <- 'Black or Black British'
region_1$ethnic[region_1$ethnic == "4002"] <- 'Black or Black British'
region_1$ethnic[region_1$ethnic == "4003"] <- 'Black or Black British'
# plinkPCA1$ethnic[plinkPCA1$ethnic == "5"] <- 'Zhong Guo'
region_1$ethnic[region_1$ethnic == "-1"] <- 'NA'
region_1$ethnic[region_1$ethnic == "-3"] <- 'NA'
region_1$ethnic[region_1$ethnic == "6"] <- 'NA'
region_1 <- subset(region_1, ethnic != 'NA')
plinkPCA2 <- merge(plinkPCA1,region_1,all.y = TRUE,by="iid")
# colnames(plinkPCA2)[ethnic.y] <- "ethnic"
# colnames(plinkPCA2)[43] <- 'ethnic'
# intersect(region_1$ethnic, plinkPCA2$ethnic)
# ggplot(plinkPCA2, aes(PC1.x,PC2.x, color = ethnic.x)) +
#   geom_point(size = 3) +
#   coord_equal() +
#   theme_light() +
#   coord_equal() +
#   theme_light() +
#   xlab(paste0("PC1 (", signif(pve$pve[1],3), "%)")) +
#   ylab(paste0("PC2 (",signif(pve$pve[2],3),"%)")) +
#   labs(title = "PCA on population structure")
#
# ggplot(region_1, aes(PC1,PC2, color = ethnic)) +
#   geom_point(size = 3) +
#   coord_equal() +
#   theme_light() +
#   coord_equal() +
#   theme_light() +
#   xlab(paste0("PC1 (", signif(pve$pve[1],3), "%)")) +
#   ylab(paste0("PC2 (",signif(pve$pve[2],3),"%)")) +
#   labs(title = "PCA on population structure")
plinkPCA_kmeans <- read_table2("data_prune_pca.eigenvec",
col_names = FALSE)
plinkPCA_kmeans <- plinkPCA_kmeans[,-c(1,2)] # Remove first 2 columns
EigenValue <- scan("data_prune_pca.eigenval")
names(plinkPCA_kmeans)[1:ncol(plinkPCA_kmeans)] <- paste0("PC", 1:(ncol(plinkPCA_kmeans)))
pve <- data.frame(PC = 1:20, pve = EigenValue / sum(EigenValue) * 100)
library(randomForest)
library(cluster)
set.seed(0)
plinkPCAsub <- plinkPCA_kmeans[,c('PC1','PC2')]
km = kmeans(plinkPCAsub, centers = 5)
# km$cluster
plinkPCA_kmeans$ethnic <- km$cluster
plinkPCA_kmeans$iid <- iid$X2
plinkPCA_kmeans_sub <- merge(plinkPCA_kmeans,region_1,all.y = TRUE,by="iid")
# colnames(plinkPCA_kmeans_sub, prefix = ethnic.x) <- "ethnic"
ggplot(region_1, aes(PC1,PC2, color = ethnic)) +
geom_point(size = 3) +
coord_equal() +
theme_light() +
coord_equal() +
theme_light() +
xlab(paste0("PC1 (", signif(pve$pve[1],3), "%)")) +
ylab(paste0("PC2 (",signif(pve$pve[2],3),"%)")) +
labs(title = "PCA on population structure, real")
# plinkPCA$region <- region$X1
# # colnames(plinkPCA)[21] <- "pop"
# plinkPCA$col<- ifelse(plinkPCA$pop >= 0, 1, 0)
# plinkPCA$col<-as.factor(plinkPCA$col)
# plinkPCA1 <- subset(plinkPCA1, ethnic != 'NA')
# plinkPCA_kmeans_sub$ethnic.x[plinkPCA_kmeans_sub$ethnic.x == "Black or Black British"] <- 'White'
# plinkPCA_kmeans_sub$ethnic.x[plinkPCA_kmeans_sub$ethnic.x == "Mixed"] <- 'Mixed'
# plinkPCA_kmeans_sub$ethnic.x[plinkPCA_kmeans_sub$ethnic.x == "White"] <- 'Asian or Asian British(Chinese included)'
# plinkPCA_kmeans_sub$ethnic.x[plinkPCA_kmeans_sub$ethnic.x == "Asian or Asian British(Chinese included)"] <- 'Black or Black British'
ggplot(plinkPCA_kmeans_sub, aes(PC1.x,PC2.x, color = ethnic.x)) +
geom_point(size = 3) +
coord_equal() +
theme_light() +
coord_equal() +
theme_light() +
xlab(paste0("PC1 (", signif(pve$pve[1],3), "%)")) +
ylab(paste0("PC2 (",signif(pve$pve[2],3),"%)")) +
labs(title = "PCA on population structure, K-means")
plinkPCA_kmeans_sub$ethnic.x[plinkPCA_kmeans_sub$ethnic.x == "3"] <- 'White'
plinkPCA_kmeans_sub$ethnic.x[plinkPCA_kmeans_sub$ethnic.x == "4"] <- 'Mixed'
plinkPCA_kmeans_sub$ethnic.x[plinkPCA_kmeans_sub$ethnic.x == "1"] <- 'Asian or Asian British(South, West, Central)'
plinkPCA_kmeans_sub$ethnic.x[plinkPCA_kmeans_sub$ethnic.x == "2"] <- 'Black or Black British'
plinkPCA_kmeans_sub$ethnic.x[plinkPCA_kmeans_sub$ethnic.x == "5"] <- 'Chinese'
# plinkPCA_kmeans_sub$ethnic.x[plinkPCA_kmeans_sub$ethnic.x == "White"] <- 'Black or Black British'
# plinkPCA_kmeans_sub$ethnic.x[plinkPCA_kmeans_sub$ethnic.x == "Mixed"] <- 'Asian or Asian British(Chinese included)'
#
# plinkPCA_kmeans_sub$ethnic.x[plinkPCA_kmeans_sub$ethnic.x == "Black or Black British"] <- 'White'
# plinkPCA_kmeans_sub$ethnic.x[plinkPCA_kmeans_sub$ethnic.x == "Asian or Asian British(Chinese included)"] <- 'Mixed'
ggplot(region_1, aes(PC1,PC2, color = ethnic)) +
geom_point(size = 3) +
coord_equal() +
theme_light() +
coord_equal() +
theme_light() +
xlab(paste0("PC1 (", signif(pve$pve[1],3), "%)")) +
ylab(paste0("PC2 (",signif(pve$pve[2],3),"%)")) +
labs(title = "PCA on population structure, real")
# plinkPCA$region <- region$X1
# # colnames(plinkPCA)[21] <- "pop"
# plinkPCA$col<- ifelse(plinkPCA$pop >= 0, 1, 0)
# plinkPCA$col<-as.factor(plinkPCA$col)
# plinkPCA1 <- subset(plinkPCA1, ethnic != 'NA')
# plinkPCA_kmeans_sub$ethnic.x[plinkPCA_kmeans_sub$ethnic.x == "Black or Black British"] <- 'White'
# plinkPCA_kmeans_sub$ethnic.x[plinkPCA_kmeans_sub$ethnic.x == "Mixed"] <- 'Mixed'
# plinkPCA_kmeans_sub$ethnic.x[plinkPCA_kmeans_sub$ethnic.x == "White"] <- 'Asian or Asian British(Chinese included)'
# plinkPCA_kmeans_sub$ethnic.x[plinkPCA_kmeans_sub$ethnic.x == "Asian or Asian British(Chinese included)"] <- 'Black or Black British'
ggplot(plinkPCA_kmeans_sub, aes(PC1.x,PC2.x, color = ethnic.x)) +
geom_point(size = 3) +
coord_equal() +
theme_light() +
coord_equal() +
theme_light() +
xlab(paste0("PC1 (", signif(pve$pve[1],3), "%)")) +
ylab(paste0("PC2 (",signif(pve$pve[2],3),"%)")) +
labs(title = "PCA on population structure, K-means")
count = 0
for (i in 1:60042) {
if (plinkPCA_kmeans_sub[i,22] == region_1[i,22]) {  ## plinkPCA2[i]$ethnic == region_1[i]$ethnic
count = count + 1
}
}
acc = count / 60042
acc
fam <- read_table2("data_qc.fam",
col_names = FALSE)
fam$region <- km$cluster
fam1 <- fam[fam$region == 4,]
fam1 <- subset(fam1, select = -region)
colnames(fam1) <- c("FID","IID","Far","Mor","Gender","Phenotype")
write.table(fam1, file = "./data_White.fam", row.names = FALSE, col.names = TRUE, quote = FALSE)
fam1 <- fam[fam$region == 1,]
fam1 <- subset(fam1, select = -region)
colnames(fam1) <- c("FID","IID","Far","Mor","Gender","Phenotype")
write.table(fam1, file = "./data_AsianSWC.fam", row.names = FALSE, col.names = TRUE, quote = FALSE)
fam1 <- fam[fam$region == 2,]
fam1 <- subset(fam1, select = -region)
colnames(fam1) <- c("FID","IID","Far","Mor","Gender","Phenotype")
write.table(fam1, file = "./data_Black.fam", row.names = FALSE, col.names = TRUE, quote = FALSE)
fam1 <- fam[fam$region == 3,]
fam1 <- subset(fam1, select = -region)
colnames(fam1) <- c("FID","IID","Far","Mor","Gender","Phenotype")
write.table(fam1, file = "./data_White.fam", row.names = FALSE, col.names = TRUE, quote = FALSE)
plinkPCA_kmeans$ethnic[plinkPCA_kmeans$ethnic == "3"] <- 'White'
plinkPCA_kmeans$ethnic[plinkPCA_kmeans$ethnic == "4"] <- 'Mixed'
plinkPCA_kmeans$ethnic[plinkPCA_kmeans$ethnic == "1"] <- 'Asian or Asian British(South, West, Central)'
plinkPCA_kmeans$ethnic[plinkPCA_kmeans$ethnic == "2"] <- 'Black or Black British'
plinkPCA_kmeans$ethnic[plinkPCA_kmeans$ethnic == "5"] <- 'Chinese'
ggplot(plinkPCA_kmeans, aes(PC1,PC2, color = ethnic)) +
geom_point(size = 3) +
coord_equal() +
theme_light() +
coord_equal() +
theme_light() +
xlab(paste0("PC1 (", signif(pve$pve[1],3), "%)")) +
ylab(paste0("PC2 (",signif(pve$pve[2],3),"%)")) +
labs(title = "PCA on population structure, ind = 66688, K-means")
ggplot(plinkPCA_kmeans, aes(PC1,PC2, color = ethnic)) +
geom_point(size = 3) +
coord_equal() +
theme_light() +
coord_equal() +
theme_light() +
xlab(paste0("PC1 (", signif(pve$pve[1],3), "%)")) +
ylab(paste0("PC2 (",signif(pve$pve[2],3),"%)")) +
labs(title = "PCA on population structure, 5 Ancestries, ind = 66688, K-means")
fam1 <- fam[fam$region == 4,]
fam1 <- subset(fam1, select = -region)
colnames(fam1) <- c("FID","IID","Far","Mor","Gender","Phenotype")
write.table(fam1, file = "./data_Mixed.fam", row.names = FALSE, col.names = TRUE, quote = FALSE)
assoc_data <- read_table2(file = "METAANALYSIS_4Ancestries.TBL", col_names = TRUE)
View(assoc_data)
library(GENESIS)
# library(GENESIS)
library(qqman)
library(tidyverse)
library(tidyr)
plinkPCA <- read_table2("data_prune_pca.eigenvec",
col_names = FALSE)
library(qqman)
library(tidyverse)
library(tidyr)
assoc_data <- read_table2(file = "data_regenie_out_firth_Phenotype.regenie", col_names = TRUE)
